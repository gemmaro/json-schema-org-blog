---
authors:
  - 
    byline: 'JSON Schema Specification Contributor'
    link: https://twitter.com/jasondesrosiers
    name: 'Jason Desrosiers'
    photo: /img/avatars/jasondesrosiers.jpeg
cover: /img/posts/2022/stability/arches.webp
date: 2022-10-21
tags:
  - Standardization
title: '安定したJSON Schemaに向けて'
type: Update
---

昨年の今頃、API Specification Conferenceで、JSON Schemaの将来について
の意見交換を主催したことがあります。その際、最も多かった話題は、JSON
Schemaはいつ「完成する」のか、というものでした。もちろん、この質問は何
度も聞いたことがあります。この疑問は、私たちがリリースに付けている「ド
ラフト」というラベルに起因しています。この「ドラフト」という言葉は、長
年にわたって私たちのコミュニティをかなり混乱させる原因となってきました。

## なぜ「ドラフト」なのですか

JSON SchemaはIETFのstandards track RFCの手続きに緩やかに従っています。
つまりリリースはインターネットドラフト（I-D）の形式をとっています。そ
れがドラフトと呼んでいる理由です。しかしJSON Schemaは実運用システムで
広く使われているため、この仕様を通常のI-Dと同様に扱うことはできません。
したがって「ドラフト」という言葉を使うのは、IETFの手続きがJSON Schema
にとってより理に適っていた頃のちょっとしたレガシーな遺物のようなものな
のです。

このことは問題になっていました。というのも「ドラフト」と聞くと「未完成」
とか「実運用向けの準備ができていない」という印象を持たれるからです。こ
れは実際のリリースの扱い方とは異なります。全てのリリースは実運用環境で
使用されることを期待し推奨しています。 OpenAPIが新版をリリースするのと
何ら変わりはありません。OpenAPIがいつ「完成」するかなんて誰も聞きませ
ん。JSON Schemaはリリースを「ドラフト」と呼んでいるがために、異なるも
のとして認識されているだけなのです。

## 実際の問題

しかしこれは単なる宣伝上の問題ではありません。JSON Schemaがいつ「ドラ
フト」から脱却するかと尋ねられるとき、その人が本当に言いたいことはJSON
Schemaがいつ「安定」するかということです。スキーマを書き、それが将来
JSON Schemaがどのように進化しても同じように機能し続けることを確認した
いのです。依存関係を更新しても正常に動作していたスキーマを更新する必要
がないようにしたいのです。

このことはライブラリの管理者にも影響します。後方互換性や前方互換性が保
証されていない複数の版のJSON Schemaに対応する必要があるのは面倒なので、
多くの管理者は古いリリースに対して[対応を打ち切
る](https://github.com/gregsdennis/json-everything/issues/310)ようにな
りました。このようなことが起こると、利用者は壊れていない既存のスキーマ
をすべて更新するか、使用しているJSON Schemaライブラリのサポートが終了
した版に固定するかという選択を迫られることになります。

## 解決策

これらの問題を次のリリースで解決することを目指しています。JSON Schema
をリリースするたびに不変で互換性のない新しい版をリリースし続けるのでは
なく、次のリリースでは進化しつつも安定した長寿命な版をリリースする予定
です。この場合の「安定」とは、いかなる変更についても、従わなければなら
ない厳格な後方および前方互換性要件が存在することを意味します。
JavaScriptの進化と同じで、既存のスキーマはどのJSON Schemaライブラリで
も動作することが保証されますが、新しい機能はすべてのライブラリで実装さ
れているわけではないので、新しい機能を使う際は危険性が伴います。

安定しつつも継続的に進化する仕様という構想はIETFの手続きにはうまく当て
はまりません。検討した道筋もありますが、私たちが規格を進化させ続け、す
ぐにでも「ドラフト」から抜け出せると思うものは提案されませんでした。し
たがって私たちの構想を実現するための最初の一歩は[私たちの主要な仕様開
発をIETFの手続きから切り離
す](https://github.com/json-schema-org/json-schema-spec/pull/1277)こと
です。この分離により、私たちの構想により資するような、主軸となる仕様開
発の新しいモデルを追求することができるようになりました。

JavaScript言語の進化の方向性の支持者であるかどうかは措くとして、言語関
係者が相互運用性と長寿命を犠牲にすることなく継続的な進化を可能にする
[効果的な手続き](https://2ality.com/2015/11/tc39-process.html)を考え出
したのは明らかだと思われます。そのため新しい手続きをJavaScript言語を進
化させるために使われている手続きを基にしたものにすることを選択しました。
次のリリースでは現在使っているキーワードや機能のほとんどが安定版として
宣言され、それらが後方互換性のない形で変化することは二度とありません。
まだ安定版とすることに抵抗がある機能やキーワードは現在定義作業中の新し
い段階的リリース手続きの一部となります。段階的リリース手続きの目的は、
その機能が十分な実装・試験・実世界での検証を経て、自信を持って安定版と
宣言できるようにすることです。この手続きはより自信を持てるようにするだ
けでなく、自信を持って物事をより早く達成することも可能にするはずです。

## 標準の考慮点

次回のリリースからJSON Schemaの仕様書をWebサイトで自前で公開する予定です。

自前で公開する場合の懸念点として、他の標準がJSON Schema仕様を参照でき
るかどうかということが挙げられます。OpenJS Foundationの会員であること
を根拠に、この手法を他の標準の中で参照することが許容されるだろうという
[フィードバッ
ク
](https://github.com/json-schema-org/json-schema-spec/pull/1277#issuecomment-1228734352)
を標準開発に携わる人々から受け取りました。_すべて_の標準化団体が同じ結
論に達するかどうかはわかりませんが、このフィードバックは大きな問題にな
ることはないという確信を与えてくれました。

主な仕様は自前で公開されますが、理に適っているところではIETFの手続きで
作業を続けています。例えばHTTPAPIs WGを通じて
`application/schema+json`のようなメディア型を登録する手続きを行ってい
るところです。またRelative JSON Pointerのような再利用可能な構成要素を
IETFを通じて標準化することも検討しています。

## 結びに

新しい手続きの詳細については決まり次第別の記事でお伝えしますが、利用者
が期待できる成果は以下の通りです。

* 安定した機能のみを使用すればJSONスキーマライブラリ間の相互運用性が保証
  され、新しいリリースに追従するためにスキーマを更新する必要はありません。
* スキーマを読み込むライブラリがその機能をサポートしている限り、安定する
  前の新機能を安全に使用することができます。
* 互換性・相互運用性の保証は、次のリリース以降にのみ適用されます。スキー
  マを安定版に更新する必要はありますが、JSON Schemaが進化しても更新し続
  ける必要はありません。
* 独自の方言や語彙はJSON Schemaの独自化や拡張のための中心的な概念であり
  続けるでしょう。
* 実装は最新の安定版リリースに対応するだけで構いません。例えば2025年リリー
  スに対応したライブラリは自動的に2023年、2024年リリースにも対応したこと
  になります。古いリリースはもはや個別版として保守する必要はありません。
  しかし「ドラフト」リリースに対応し続ける実装は現在の安定版リリースとは
  異なる版としてそれらを維持する必要があります。
